---
/**
 * Hero Section Component
 * Full viewport hero with optimized background loading
 */
import { Image } from 'astro:assets';
import { getRandomR2Image } from '@/utils/r2';

interface Props {
  lang: 'en' | 'es';
  content: {
    title: string;
    subtitle: string;
    description: string;
    cta: {
      primary: string;
      secondary: string;
    };
  };
}

const { lang, content } = Astro.props;

// Fetch random image from R2 'tutti/' directory
let heroImage: { url: string } | null = null;
try {
  heroImage = await getRandomR2Image('tutti/');
} catch (error) {
  console.error('Failed to load R2 image:', error);
}

const backgroundImageUrl = heroImage?.url || null;
---

<section class="hero relative min-h-screen flex items-center justify-center overflow-hidden">
  <!-- Background con placeholder instantáneo -->
  <div class="absolute inset-0 z-0">
    <!-- Overlay -->
    <div class="absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/70 z-10"></div>

    <!-- Placeholder gradient (carga instantánea) -->
    <div class="hero-placeholder absolute inset-0 bg-gradient-to-br from-[#8B4513] via-[#6D3410] to-[#5E3A10]"></div>

    <!-- Imagen real (EAGER load para LCP) -->
    {backgroundImageUrl && (
      <img
        src={backgroundImageUrl}
        alt="Cuarteto Metanoia"
        class="hero-image absolute inset-0 w-full h-full object-cover opacity-0"
        loading="eager"
        fetchpriority="high"
        decoding="async"
      />
    )}
  </div>

  <!-- Content -->
  <div class="container relative z-20 text-center text-white py-20">
    <h1 class="hero-title font-serif font-bold mb-6 animate-fade-in drop-shadow-lg !text-white">
      {content.title}
    </h1>

    <p class="hero-subtitle text-2xl md:text-3xl font-light mb-6 animate-fade-in-up stagger-1 drop-shadow-md !text-white">
      {content.subtitle}
    </p>

    <p class="text-lg md:text-xl max-w-3xl mx-auto mb-10 opacity-90 animate-fade-in-up stagger-2 drop-shadow-md !text-white">
      {content.description}
    </p>

    <!-- Scroll indicator -->
    <div class="absolute bottom-10 left-1/2 transform -translate-x-1/2 animate-bounce">
      <svg
        class="w-6 h-6 text-white opacity-75"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        aria-hidden="true"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M19 14l-7 7m0 0l-7-7m7 7V3"
        />
      </svg>
    </div>
  </div>
</section>

<style>
  .hero-title {
    font-size: clamp(3rem, 8vw, 6rem);
    line-height: 1.1;
    letter-spacing: -0.02em;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  }

  .hero-subtitle {
    letter-spacing: 0.02em;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
  }

  /* Placeholder gradient (carga instantánea) */
  .hero-placeholder {
    animation: pulse-gradient 8s ease-in-out infinite;
  }

  @keyframes pulse-gradient {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.9;
    }
  }

  /* Fade-in progresivo de la imagen real */
  .hero-image {
    transition: opacity 1s ease-in-out;
  }

  .hero-image.loaded {
    opacity: 1 !important;
  }

  /* Stagger delays */
  .stagger-1 { animation-delay: 200ms; }
  .stagger-2 { animation-delay: 400ms; }

  /* Button hover effects */
  .btn-primary,
  .btn-secondary {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  .btn-primary:hover,
  .btn-secondary:hover {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
  }
</style>

<script>
  // Progressive image loading
  const heroImage = document.querySelector('.hero-image') as HTMLImageElement;

  if (heroImage) {
    // Si la imagen ya está en caché, mostrar inmediatamente
    if (heroImage.complete) {
      heroImage.classList.add('loaded');
    } else {
      // Esperar a que cargue y hacer fade-in
      heroImage.addEventListener('load', () => {
        heroImage.classList.add('loaded');
      });

      // Timeout de seguridad: si tarda más de 3s, mostrar el placeholder
      setTimeout(() => {
        if (!heroImage.classList.contains('loaded')) {
          console.warn('Hero image taking too long, using placeholder');
        }
      }, 3000);
    }
  }
</script>
